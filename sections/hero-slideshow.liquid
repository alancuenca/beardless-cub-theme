{% comment %}
  Hero Slideshow Section

  Full-width hero section with slideshow capability.
  Features autoplay, navigation, touch/swipe support, and responsive images.
  Inspired by modern e-commerce hero patterns (SLMD Skincare, etc.)
{% endcomment %}

{% liquid
  assign slide_count = section.blocks.size
  assign autoplay = section.settings.autoplay
  assign autoplay_speed = section.settings.autoplay_speed | times: 1000
  assign section_height = section.settings.section_height | default: 'moderate'
%}

<section
  class="hero hero--{{ section_height }}"
  data-hero-slideshow
  data-autoplay="{{ autoplay }}"
  data-autoplay-speed="{{ autoplay_speed }}"
  aria-label="{{ 'sections.hero.name' | t }}"
>
  <div class="hero__slides" data-hero-slides>
    {% for block in section.blocks %}
      {% liquid
        assign is_first = forloop.first
        assign content_position = block.settings.content_position | default: 'middle_center'
        assign text_color = block.settings.text_color | default: 'light'
        assign overlay_opacity = block.settings.overlay_opacity | default: 30
        assign image_position = block.settings.image_position | default: 'center center'

        # Use mobile image if set, otherwise fall back to main image
        assign desktop_image = block.settings.image
        assign mobile_image = block.settings.mobile_image | default: desktop_image
      %}

      <article
        class="hero__slide{% if is_first %} is-active{% endif %}"
        data-hero-slide
        data-index="{{ forloop.index0 }}"
        {{ block.shopify_attributes }}
        aria-hidden="{% if is_first %}false{% else %}true{% endif %}"
      >
        {% comment %} Background Image {% endcomment %}
        <div class="hero__media">
          {% if desktop_image %}
            <picture>
              {% comment %} Desktop source (768px+) {% endcomment %}
              <source
                media="(min-width: 768px)"
                srcset="
                  {{ desktop_image | image_url: width: 1200 }} 1200w,
                  {{ desktop_image | image_url: width: 1600 }} 1600w,
                  {{ desktop_image | image_url: width: 2000 }} 2000w,
                  {{ desktop_image | image_url: width: 2400 }} 2400w
                "
                sizes="100vw"
              >
              {% comment %} Mobile/Default {% endcomment %}
              <img
                src="{{ mobile_image | image_url: width: 800 }}"
                srcset="
                  {{ mobile_image | image_url: width: 400 }} 400w,
                  {{ mobile_image | image_url: width: 600 }} 600w,
                  {{ mobile_image | image_url: width: 800 }} 800w,
                  {{ mobile_image | image_url: width: 1000 }} 1000w
                "
                sizes="100vw"
                alt="{{ desktop_image.alt | default: block.settings.heading | escape }}"
                class="hero__image"
                style="object-position: {{ image_position }};"
                width="{{ mobile_image.width }}"
                height="{{ mobile_image.height }}"
                {% if is_first %}
                  loading="eager"
                  fetchpriority="high"
                {% else %}
                  loading="lazy"
                {% endif %}
              >
            </picture>
          {% else %}
            <div class="hero__placeholder">
              {{ 'lifestyle-1' | placeholder_svg_tag }}
            </div>
          {% endif %}

          {% comment %} Overlay {% endcomment %}
          {% if overlay_opacity > 0 %}
            <div
              class="hero__overlay"
              style="opacity: {{ overlay_opacity | divided_by: 100.0 }};"
              aria-hidden="true"
            ></div>
          {% endif %}
        </div>

        {% comment %} Content {% endcomment %}
        <div class="hero__content hero__content--{{ content_position }} hero__content--{{ text_color }}">
          <div class="hero__content-inner">
            {% if block.settings.subheading != blank %}
              <p class="hero__subheading">{{ block.settings.subheading }}</p>
            {% endif %}

            {% if block.settings.heading != blank %}
              <h2 class="hero__heading">{{ block.settings.heading }}</h2>
            {% endif %}

            {% if block.settings.text != blank %}
              <p class="hero__text">{{ block.settings.text }}</p>
            {% endif %}

            {% if block.settings.button_text != blank and block.settings.button_link != blank %}
              <a href="{{ block.settings.button_link }}" class="hero__cta">
                <span>{{ block.settings.button_text }}</span>
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                  <path d="M4 10h12M12 6l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </a>
            {% endif %}
          </div>
        </div>
      </article>
    {% endfor %}
  </div>

  {% comment %} Navigation (only if multiple slides) {% endcomment %}
  {% if slide_count > 1 %}
    <nav class="hero__nav" aria-label="{{ 'sections.hero.navigation_label' | t }}">
      <button
        type="button"
        class="hero__nav-btn hero__nav-btn--prev"
        data-hero-prev
        aria-label="{{ 'sections.hero.previous_slide' | t }}"
      >
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" aria-hidden="true">
          <path d="M12 4l-6 6 6 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>

      <div class="hero__dots" role="tablist">
        {% for block in section.blocks %}
          <button
            type="button"
            class="hero__dot{% if forloop.first %} is-active{% endif %}"
            data-hero-dot
            data-index="{{ forloop.index0 }}"
            role="tab"
            aria-selected="{% if forloop.first %}true{% else %}false{% endif %}"
            aria-label="{{ 'sections.hero.slide' | t }} {{ forloop.index }}"
          ></button>
        {% endfor %}
      </div>

      <button
        type="button"
        class="hero__nav-btn hero__nav-btn--next"
        data-hero-next
        aria-label="{{ 'sections.hero.next_slide' | t }}"
      >
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" aria-hidden="true">
          <path d="M8 4l6 6-6 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </nav>

    {% if autoplay %}
      <div class="hero__progress" data-hero-progress aria-hidden="true">
        <div class="hero__progress-bar" style="--duration: {{ autoplay_speed }}ms;"></div>
      </div>
    {% endif %}
  {% endif %}
</section>

{% javascript %}
class HeroSlideshow {
  constructor(el) {
    this.el = el;
    this.slides = el.querySelectorAll('[data-hero-slide]');
    this.dots = el.querySelectorAll('[data-hero-dot]');
    this.prevBtn = el.querySelector('[data-hero-prev]');
    this.nextBtn = el.querySelector('[data-hero-next]');
    this.progress = el.querySelector('[data-hero-progress]');

    this.current = 0;
    this.total = this.slides.length;
    this.autoplay = el.dataset.autoplay === 'true';
    this.speed = parseInt(el.dataset.autoplaySpeed, 10) || 5000;
    this.timer = null;
    this.paused = false;

    if (this.total > 1) this.init();
  }

  init() {
    this.prevBtn?.addEventListener('click', () => this.prev());
    this.nextBtn?.addEventListener('click', () => this.next());
    this.dots.forEach((dot, i) => dot.addEventListener('click', () => this.goTo(i)));

    // Pause on interaction
    this.el.addEventListener('mouseenter', () => this.pause());
    this.el.addEventListener('mouseleave', () => this.resume());
    this.el.addEventListener('focusin', () => this.pause());
    this.el.addEventListener('focusout', (e) => {
      if (!this.el.contains(e.relatedTarget)) this.resume();
    });

    // Keyboard navigation
    this.el.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') this.prev();
      if (e.key === 'ArrowRight') this.next();
    });

    // Touch support
    let startX = 0;
    this.el.addEventListener('touchstart', (e) => { startX = e.touches[0].clientX; }, { passive: true });
    this.el.addEventListener('touchend', (e) => {
      const diff = startX - e.changedTouches[0].clientX;
      if (Math.abs(diff) > 50) diff > 0 ? this.next() : this.prev();
    }, { passive: true });

    if (this.autoplay) this.startAutoplay();
  }

  goTo(index) {
    if (index === this.current) return;

    this.slides[this.current].classList.remove('is-active');
    this.slides[this.current].setAttribute('aria-hidden', 'true');
    this.dots[this.current]?.classList.remove('is-active');
    this.dots[this.current]?.setAttribute('aria-selected', 'false');

    this.slides[index].classList.add('is-active');
    this.slides[index].setAttribute('aria-hidden', 'false');
    this.dots[index]?.classList.add('is-active');
    this.dots[index]?.setAttribute('aria-selected', 'true');

    this.current = index;
    if (this.autoplay && !this.paused) this.restartAutoplay();
  }

  next() { this.goTo((this.current + 1) % this.total); }
  prev() { this.goTo((this.current - 1 + this.total) % this.total); }

  startAutoplay() {
    this.timer = setInterval(() => { if (!this.paused) this.next(); }, this.speed);
    this.progress?.classList.add('is-playing');
  }

  restartAutoplay() {
    clearInterval(this.timer);
    this.progress?.classList.remove('is-playing');
    void this.progress?.offsetWidth; // Force reflow
    this.startAutoplay();
  }

  pause() { this.paused = true; this.progress?.classList.add('is-paused'); }
  resume() { this.paused = false; this.progress?.classList.remove('is-paused'); }
}

document.querySelectorAll('[data-hero-slideshow]').forEach(el => new HeroSlideshow(el));
{% endjavascript %}

{% stylesheet %}
/* ==========================================================================
   Hero Slideshow - Clean, Modern Implementation
   ========================================================================== */

.hero {
  position: relative;
  width: 100%;
  overflow: hidden;
  background-color: var(--color-foreground);
}

/* Height Variants */
.hero--compact {
  height: clamp(280px, 50vw, 400px);
}

.hero--moderate {
  height: clamp(350px, 60vw, 500px);
}

.hero--large {
  height: clamp(400px, 70vw, 600px);
}

/* Slides Container */
.hero__slides {
  position: relative;
  width: 100%;
  height: 100%;
}

/* Individual Slide */
.hero__slide {
  position: absolute;
  inset: 0;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.6s ease, visibility 0.6s ease;
}

.hero__slide.is-active {
  opacity: 1;
  visibility: visible;
}

/* Media Container */
.hero__media {
  position: absolute;
  inset: 0;
}

.hero__image {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.hero__placeholder {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: var(--color-muted);
}

.hero__placeholder svg {
  width: 40%;
  max-width: 200px;
  height: auto;
  opacity: 0.2;
}

/* Overlay */
.hero__overlay {
  position: absolute;
  inset: 0;
  background: linear-gradient(
    to bottom,
    rgba(0, 0, 0, 0.1) 0%,
    rgba(0, 0, 0, 0.4) 100%
  );
  pointer-events: none;
}

/* Content */
.hero__content {
  position: absolute;
  inset: 0;
  display: flex;
  padding: var(--space-lg);
  z-index: 2;
}

@media (min-width: 768px) {
  .hero__content {
    padding: var(--space-2xl);
  }
}

/* Content Positioning */
.hero__content--top_left { align-items: flex-start; justify-content: flex-start; }
.hero__content--top_center { align-items: flex-start; justify-content: center; text-align: center; }
.hero__content--top_right { align-items: flex-start; justify-content: flex-end; text-align: right; }
.hero__content--middle_left { align-items: center; justify-content: flex-start; }
.hero__content--middle_center { align-items: center; justify-content: center; text-align: center; }
.hero__content--middle_right { align-items: center; justify-content: flex-end; text-align: right; }
.hero__content--bottom_left { align-items: flex-end; justify-content: flex-start; }
.hero__content--bottom_center { align-items: flex-end; justify-content: center; text-align: center; }
.hero__content--bottom_right { align-items: flex-end; justify-content: flex-end; text-align: right; }

/* Content Colors */
.hero__content--light { color: #fff; }
.hero__content--dark { color: var(--color-foreground); }

/* Content Inner */
.hero__content-inner {
  max-width: 540px;
}

@media (min-width: 768px) {
  .hero__content-inner {
    max-width: 600px;
  }
}

/* Typography */
.hero__subheading {
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.2em;
  margin-bottom: 0.75rem;
  opacity: 0.85;
}

@media (min-width: 768px) {
  .hero__subheading {
    font-size: 0.8125rem;
  }
}

.hero__heading {
  font-size: clamp(1.75rem, 5vw, 3.5rem);
  font-weight: 700;
  line-height: 1.1;
  margin: 0 0 1rem;
  letter-spacing: -0.02em;
}

.hero__text {
  font-size: 0.9375rem;
  line-height: 1.6;
  margin: 0 0 1.5rem;
  opacity: 0.9;
  max-width: 480px;
}

@media (min-width: 768px) {
  .hero__text {
    font-size: 1.0625rem;
  }
}

.hero__content--middle_center .hero__text,
.hero__content--top_center .hero__text,
.hero__content--bottom_center .hero__text {
  margin-left: auto;
  margin-right: auto;
}

/* CTA Button */
.hero__cta {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.875rem 1.5rem;
  font-size: 0.875rem;
  font-weight: 600;
  text-decoration: none;
  border-radius: 4px;
  transition: all 0.2s ease;
}

.hero__content--light .hero__cta {
  background-color: #fff;
  color: var(--color-foreground);
}

.hero__content--light .hero__cta:hover {
  background-color: rgba(255, 255, 255, 0.9);
  transform: translateY(-1px);
}

.hero__content--dark .hero__cta {
  background-color: var(--color-foreground);
  color: #fff;
}

.hero__content--dark .hero__cta:hover {
  opacity: 0.9;
  transform: translateY(-1px);
}

.hero__cta svg {
  transition: transform 0.2s ease;
}

.hero__cta:hover svg {
  transform: translateX(3px);
}

/* Navigation */
.hero__nav {
  position: absolute;
  bottom: var(--space-lg);
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: 1rem;
  z-index: 10;
}

@media (min-width: 768px) {
  .hero__nav {
    bottom: var(--space-xl);
  }
}

.hero__nav-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  background-color: rgba(255, 255, 255, 0.15);
  color: #fff;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: background-color 0.2s ease;
  cursor: pointer;
}

.hero__nav-btn:hover {
  background-color: rgba(255, 255, 255, 0.25);
}

/* Dots */
.hero__dots {
  display: flex;
  gap: 0.5rem;
}

.hero__dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background-color: rgba(255, 255, 255, 0.4);
  border: none;
  padding: 0;
  cursor: pointer;
  transition: all 0.2s ease;
}

.hero__dot:hover {
  background-color: rgba(255, 255, 255, 0.6);
}

.hero__dot.is-active {
  background-color: #fff;
  transform: scale(1.25);
}

/* Progress Bar */
.hero__progress {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 2px;
  background-color: rgba(255, 255, 255, 0.2);
  z-index: 10;
}

.hero__progress-bar {
  height: 100%;
  width: 0;
  background-color: rgba(255, 255, 255, 0.8);
}

.hero__progress.is-playing .hero__progress-bar {
  animation: heroProgress var(--duration, 5000ms) linear infinite;
}

.hero__progress.is-paused .hero__progress-bar {
  animation-play-state: paused;
}

@keyframes heroProgress {
  from { width: 0; }
  to { width: 100%; }
}
{% endstylesheet %}

{% schema %}
{
  "name": "t:sections.hero.name",
  "tag": "section",
  "class": "section-hero",
  "max_blocks": 6,
  "settings": [
    {
      "type": "select",
      "id": "section_height",
      "label": "t:sections.hero.section_height",
      "options": [
        { "value": "compact", "label": "t:options.section_height.compact" },
        { "value": "moderate", "label": "t:options.section_height.moderate" },
        { "value": "large", "label": "t:options.section_height.large" }
      ],
      "default": "moderate"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "t:sections.hero.autoplay",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "min": 3,
      "max": 10,
      "step": 1,
      "unit": "s",
      "label": "t:sections.hero.autoplay_speed",
      "default": 5
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "t:sections.hero.slide",
      "settings": [
        {
          "type": "header",
          "content": "t:sections.hero.image_heading"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "t:sections.hero.image"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "t:sections.hero.mobile_image",
          "info": "t:sections.hero.mobile_image_info"
        },
        {
          "type": "select",
          "id": "image_position",
          "label": "t:sections.hero.image_position",
          "info": "t:sections.hero.image_position_info",
          "options": [
            { "value": "top left", "label": "t:options.image_position.top_left" },
            { "value": "top center", "label": "t:options.image_position.top_center" },
            { "value": "top right", "label": "t:options.image_position.top_right" },
            { "value": "center left", "label": "t:options.image_position.center_left" },
            { "value": "center center", "label": "t:options.image_position.center" },
            { "value": "center right", "label": "t:options.image_position.center_right" },
            { "value": "bottom left", "label": "t:options.image_position.bottom_left" },
            { "value": "bottom center", "label": "t:options.image_position.bottom_center" },
            { "value": "bottom right", "label": "t:options.image_position.bottom_right" }
          ],
          "default": "center center"
        },
        {
          "type": "range",
          "id": "overlay_opacity",
          "min": 0,
          "max": 80,
          "step": 5,
          "unit": "%",
          "label": "t:sections.hero.overlay_opacity",
          "default": 30
        },
        {
          "type": "header",
          "content": "t:sections.hero.content_heading"
        },
        {
          "type": "text",
          "id": "subheading",
          "label": "t:sections.hero.subheading",
          "default": "New Collection"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "t:sections.hero.heading",
          "default": "Discover Timeless Elegance"
        },
        {
          "type": "textarea",
          "id": "text",
          "label": "t:labels.text",
          "default": "Explore our curated selection of handcrafted jewelry and refined clothing for the modern individual."
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "t:sections.hero.button_text",
          "default": "Shop Now"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "t:sections.hero.button_link"
        },
        {
          "type": "header",
          "content": "t:sections.hero.layout_heading"
        },
        {
          "type": "select",
          "id": "content_position",
          "label": "t:sections.hero.content_position",
          "options": [
            { "value": "top_left", "label": "t:options.content_position.top_left" },
            { "value": "top_center", "label": "t:options.content_position.top_center" },
            { "value": "top_right", "label": "t:options.content_position.top_right" },
            { "value": "middle_left", "label": "t:options.content_position.middle_left" },
            { "value": "middle_center", "label": "t:options.content_position.middle_center" },
            { "value": "middle_right", "label": "t:options.content_position.middle_right" },
            { "value": "bottom_left", "label": "t:options.content_position.bottom_left" },
            { "value": "bottom_center", "label": "t:options.content_position.bottom_center" },
            { "value": "bottom_right", "label": "t:options.content_position.bottom_right" }
          ],
          "default": "middle_center"
        },
        {
          "type": "select",
          "id": "text_color",
          "label": "t:sections.hero.text_color",
          "options": [
            { "value": "light", "label": "t:options.text_color.light" },
            { "value": "dark", "label": "t:options.text_color.dark" }
          ],
          "default": "light"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.hero.name",
      "blocks": [
        {
          "type": "slide",
          "settings": {
            "heading": "Discover Timeless Elegance",
            "subheading": "New Collection",
            "text": "Explore our curated selection of handcrafted jewelry and refined clothing for the modern individual.",
            "button_text": "Shop Now"
          }
        }
      ]
    }
  ]
}
{% endschema %}

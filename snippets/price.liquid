{% doc %}
  Renders product price with support for compare-at pricing and unit pricing.

  @param {product} product - The product object (required)
  @param {boolean} [show_compare_at] - Show compare at / sale price (default: true)
  @param {boolean} [show_unit_price] - Show unit price if available (default: false)
  @param {string} [price_class] - Additional CSS classes

  @example
  {% render 'price', product: product, show_compare_at: true %}
{% enddoc %}

{% liquid
  assign product = product | default: empty
  assign show_compare_at = show_compare_at | default: true
  assign show_unit_price = show_unit_price | default: false
  assign price_class = price_class | default: ''

  unless product != empty
    break
  endunless

  assign current_variant = product.selected_or_first_available_variant
  assign on_sale = false

  if product.compare_at_price > product.price
    assign on_sale = true
  endif
%}

<div class="price {{ price_class }}{% if on_sale %} price--on-sale{% endif %}">
  {% if product.price_varies %}
    <span class="price__from">{{ 'products.from' | t }}</span>
  {% endif %}

  <span class="price__regular">
    {{ product.price | money }}
  </span>

  {% if show_compare_at and on_sale %}
    <span class="price__compare">
      <s>{{ product.compare_at_price | money }}</s>
    </span>

    {% assign savings = product.compare_at_price | minus: product.price %}
    {% assign savings_percent = savings | times: 100.0 | divided_by: product.compare_at_price | round %}
    <span class="price__savings">
      {{ 'products.save_percent' | t: percent: savings_percent }}
    </span>
  {% endif %}

  {% if show_unit_price and current_variant.unit_price_measurement %}
    <span class="price__unit">
      {{ current_variant.unit_price | money }}
      <span class="price__unit-separator">/</span>
      {% if current_variant.unit_price_measurement.reference_value != 1 %}
        {{ current_variant.unit_price_measurement.reference_value }}
      {% endif %}
      {{ current_variant.unit_price_measurement.reference_unit }}
    </span>
  {% endif %}
</div>

{% stylesheet %}
  .price {
    display: flex;
    flex-wrap: wrap;
    align-items: baseline;
    gap: var(--space-xs) var(--space-sm);
    font-size: var(--text-base);
  }

  .price__from {
    font-size: var(--text-sm);
    color: var(--color-secondary);
  }

  .price__regular {
    font-weight: 500;
  }

  .price--on-sale .price__regular {
    color: var(--color-accent);
  }

  .price__compare {
    color: var(--color-secondary);
    font-size: var(--text-sm);
  }

  .price__compare s {
    text-decoration: line-through;
  }

  .price__savings {
    font-size: var(--text-xs);
    font-weight: 500;
    color: var(--color-accent);
    padding: var(--space-xs) var(--space-sm);
    background-color: rgba(184, 134, 11, 0.1);
    border-radius: var(--radius-sm);
  }

  .price__unit {
    width: 100%;
    font-size: var(--text-xs);
    color: var(--color-secondary);
  }
{% endstylesheet %}
